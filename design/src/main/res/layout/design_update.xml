<?xml version="1.0" encoding="utf-8"?>
<layout xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    xmlns:tools="http://schemas.android.com/tools">

    <data>
        <import type="android.view.View" />
        <import type="com.github.kr328.clash.design.UpdateDesign.Request" />

        <variable
            name="self"
            type="com.github.kr328.clash.design.UpdateDesign" />

        <variable
            name="checking"
            type="boolean" />

        <variable
            name="hasUpdate"
            type="boolean" />

        <variable
            name="noUpdate"
            type="boolean" />

        <variable
            name="downloading"
            type="boolean" />

        <variable
            name="downloadComplete"
            type="boolean" />

        <variable
            name="hasError"
            type="boolean" />

        <variable
            name="versionName"
            type="String" />

        <variable
            name="changelog"
            type="String" />

        <variable
            name="fileSize"
            type="String" />

        <variable
            name="downloadProgress"
            type="float" />

        <variable
            name="downloadProgressText"
            type="String" />

        <variable
            name="errorMessage"
            type="String" />
    </data>

    <androidx.coordinatorlayout.widget.CoordinatorLayout
        android:layout_width="match_parent"
        android:layout_height="match_parent"
        android:paddingStart="@{self.surface.insets.start}"
        android:paddingEnd="@{self.surface.insets.end}">

        <com.github.kr328.clash.design.view.ObservableScrollView
            android:id="@+id/scroll_root"
            android:layout_width="match_parent"
            android:layout_height="match_parent"
            android:scrollbars="none">

            <LinearLayout
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:orientation="vertical"
                android:paddingLeft="16dp"
                android:paddingRight="16dp"
                android:paddingTop="@{(float) self.surface.insets.top + @dimen/toolbar_height}"
                android:paddingBottom="@{self.surface.insets.bottom}">

                <!-- Checking for updates -->
                <LinearLayout
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:gravity="center"
                    android:orientation="vertical"
                    android:padding="32dp"
                    android:visibility="@{checking ? View.VISIBLE : View.GONE}">

                    <com.google.android.material.progressindicator.CircularProgressIndicator
                        android:layout_width="wrap_content"
                        android:layout_height="wrap_content"
                        android:indeterminate="true" />

                    <TextView
                        android:layout_width="wrap_content"
                        android:layout_height="wrap_content"
                        android:layout_marginTop="16dp"
                        android:text="@string/checking_for_updates"
                        android:textAppearance="?attr/textAppearanceBodyLarge" />
                </LinearLayout>

                <!-- No update available -->
                <LinearLayout
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:gravity="center"
                    android:orientation="vertical"
                    android:padding="32dp"
                    android:visibility="@{noUpdate ? View.VISIBLE : View.GONE}">

                    <ImageView
                        android:layout_width="64dp"
                        android:layout_height="64dp"
                        android:src="@drawable/ic_baseline_check_circle"
                        android:tint="?attr/colorPrimary"
                        tools:ignore="UseAppTint" />

                    <TextView
                        android:layout_width="wrap_content"
                        android:layout_height="wrap_content"
                        android:layout_marginTop="16dp"
                        android:text="@string/already_latest_version"
                        android:textAppearance="?attr/textAppearanceHeadlineSmall" />

                    <TextView
                        android:layout_width="wrap_content"
                        android:layout_height="wrap_content"
                        android:layout_marginTop="8dp"
                        android:alpha="0.7"
                        android:text="@string/no_update_available"
                        android:textAppearance="?attr/textAppearanceBodyMedium" />
                </LinearLayout>

                <!-- Error -->
                <LinearLayout
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:gravity="center"
                    android:orientation="vertical"
                    android:padding="32dp"
                    android:visibility="@{hasError ? View.VISIBLE : View.GONE}">

                    <ImageView
                        android:layout_width="64dp"
                        android:layout_height="64dp"
                        android:src="@drawable/ic_baseline_error"
                        android:tint="?attr/colorError"
                        tools:ignore="UseAppTint" />

                    <TextView
                        android:layout_width="wrap_content"
                        android:layout_height="wrap_content"
                        android:layout_marginTop="16dp"
                        android:text="@string/update_check_failed"
                        android:textAppearance="?attr/textAppearanceHeadlineSmall" />

                    <TextView
                        android:layout_width="wrap_content"
                        android:layout_height="wrap_content"
                        android:layout_marginTop="8dp"
                        android:alpha="0.7"
                        android:text="@{errorMessage}"
                        android:textAppearance="?attr/textAppearanceBodyMedium" />

                    <com.google.android.material.button.MaterialButton
                        android:layout_width="wrap_content"
                        android:layout_height="wrap_content"
                        android:layout_marginTop="16dp"
                        android:onClick="@{() -> self.request(Request.OpenInBrowser)}"
                        android:text="@string/open_in_browser"
                        style="@style/Widget.Material3.Button.OutlinedButton" />
                </LinearLayout>

                <!-- Update available -->
                <LinearLayout
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:orientation="vertical"
                    android:visibility="@{hasUpdate ? View.VISIBLE : View.GONE}">

                    <com.google.android.material.card.MaterialCardView
                        android:layout_width="match_parent"
                        android:layout_height="wrap_content"
                        app:cardElevation="2dp"
                        app:cardCornerRadius="12dp">

                        <LinearLayout
                            android:layout_width="match_parent"
                            android:layout_height="wrap_content"
                            android:orientation="vertical"
                            android:padding="16dp">

                            <TextView
                                android:layout_width="wrap_content"
                                android:layout_height="wrap_content"
                                android:text="@string/new_version_available"
                                android:textAppearance="?attr/textAppearanceLabelMedium"
                                android:textColor="?attr/colorPrimary" />

                            <TextView
                                android:layout_width="wrap_content"
                                android:layout_height="wrap_content"
                                android:layout_marginTop="4dp"
                                android:text="@{versionName}"
                                android:textAppearance="?attr/textAppearanceHeadlineMedium"
                                tools:text="v3.0.4" />

                            <TextView
                                android:layout_width="wrap_content"
                                android:layout_height="wrap_content"
                                android:layout_marginTop="4dp"
                                android:alpha="0.7"
                                android:text="@{@string/format_file_size(fileSize)}"
                                android:textAppearance="?attr/textAppearanceBodySmall"
                                tools:text="Size: 12.5 MB" />
                        </LinearLayout>
                    </com.google.android.material.card.MaterialCardView>

                    <!-- Changelog -->
                    <TextView
                        android:layout_width="wrap_content"
                        android:layout_height="wrap_content"
                        android:layout_marginTop="24dp"
                        android:text="@string/changelog"
                        android:textAppearance="?attr/textAppearanceTitleMedium" />

                    <com.google.android.material.card.MaterialCardView
                        android:layout_width="match_parent"
                        android:layout_height="wrap_content"
                        android:layout_marginTop="8dp"
                        app:cardElevation="0dp"
                        app:cardBackgroundColor="?attr/colorSurfaceVariant"
                        app:cardCornerRadius="8dp">

                        <TextView
                            android:layout_width="match_parent"
                            android:layout_height="wrap_content"
                            android:padding="12dp"
                            android:text="@{changelog}"
                            android:textAppearance="?attr/textAppearanceBodyMedium"
                            tools:text="- Bug fixes\n- Performance improvements" />
                    </com.google.android.material.card.MaterialCardView>

                    <!-- Download progress -->
                    <LinearLayout
                        android:layout_width="match_parent"
                        android:layout_height="wrap_content"
                        android:layout_marginTop="24dp"
                        android:orientation="vertical"
                        android:visibility="@{downloading ? View.VISIBLE : View.GONE}">

                        <TextView
                            android:layout_width="wrap_content"
                            android:layout_height="wrap_content"
                            android:text="@string/downloading"
                            android:textAppearance="?attr/textAppearanceTitleMedium" />

                        <com.google.android.material.progressindicator.LinearProgressIndicator
                            android:layout_width="match_parent"
                            android:layout_height="wrap_content"
                            android:layout_marginTop="8dp"
                            android:progress="@{(int)(downloadProgress * 100)}" />

                        <TextView
                            android:layout_width="wrap_content"
                            android:layout_height="wrap_content"
                            android:layout_marginTop="4dp"
                            android:alpha="0.7"
                            android:text="@{downloadProgressText}"
                            android:textAppearance="?attr/textAppearanceBodySmall" />
                    </LinearLayout>

                    <!-- Action buttons -->
                    <LinearLayout
                        android:layout_width="match_parent"
                        android:layout_height="wrap_content"
                        android:layout_marginTop="24dp"
                        android:gravity="end"
                        android:orientation="horizontal">

                        <com.google.android.material.button.MaterialButton
                            android:layout_width="wrap_content"
                            android:layout_height="wrap_content"
                            android:layout_marginEnd="8dp"
                            android:onClick="@{() -> self.request(Request.OpenInBrowser)}"
                            android:text="@string/open_in_browser"
                            style="@style/Widget.Material3.Button.TextButton" />

                        <com.google.android.material.button.MaterialButton
                            android:layout_width="wrap_content"
                            android:layout_height="wrap_content"
                            android:enabled="@{!downloading}"
                            android:onClick="@{() -> self.request(downloadComplete ? Request.Install : Request.Download)}"
                            android:text="@{downloadComplete ? @string/install : @string/download}"
                            tools:text="Download" />
                    </LinearLayout>
                </LinearLayout>

            </LinearLayout>
        </com.github.kr328.clash.design.view.ObservableScrollView>

        <com.github.kr328.clash.design.view.ActivityBarLayout
            android:id="@+id/activity_bar_layout"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:paddingTop="@{self.surface.insets.top}"
            android:paddingEnd="@dimen/item_tailing_margin">

            <include layout="@layout/common_activity_bar" />
        </com.github.kr328.clash.design.view.ActivityBarLayout>

    </androidx.coordinatorlayout.widget.CoordinatorLayout>
</layout>
